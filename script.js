        function convertColors(text, isPeso = false) {
            if (isPeso) {
                return `<span style="color: #${text};">${text}</span>`;
            } else {
                return text.replace(/\^([0-9A-Fa-f]{6})/g, '<span style="color: #$1;">');
            }
        }

        $(document).ready(function () {
            function fetchData() {
                return fetch('itemlist.lub')
                    .then(response => response.arrayBuffer())
                    .then(buffer => {
                        var decoder = new TextDecoder('ISO-8859-1');
                        var text = decoder.decode(new Uint8Array(buffer));
                        return parseData(text);
                    });
            }

            function parseData(data) {
                var formattedData = [];

                var patternInfo = /\[(\d+)\]\s*=\s*{\s*.*?identifiedDisplayName\s*=\s*"([^"]*)".*?identifiedDescriptionName\s*=\s*{([^}]+).*?slotCount\s*=\s*(\d+).*?ClassNum\s*=\s*(\d+)/gs;
                var matches;

                while (matches = patternInfo.exec(data)) {
                    var itemid = matches[1];
                    var itemName = matches[2];
                    var identifiedDescriptionName = matches[3];
                    var slotCount = matches[4];

                    var itemImage = '';
                    if (![1833, 2158, 2163, 2017, 2175, 2157, 2493, 2588, 2572, 2494, 2598, 1314, 1315, 2594, 2595, 1397, 1194, 1297, 1431, 1581, 1582, 1589, 1662, 1663, 1698, 2488, 2489, 2490, 2592, 2593, 2599, 2632, 2633, 2834, 2837, 2838, 2839, 2836, 2840, 2870, 2876, 2877, 2878, 2879, 2880, 2882, 2889, 2893, 2900, 2901, 2902, 2903, 2905, 2908, 2909, 2912, 2929, 2930, 2931, 2932, 2933, 2934, 2937, 2938, 2939, 2948, 3629, 3630, 3633, 3634, 3737, 4543, 4544, 4541, 4535, 4536, 4770, 4773, 4776, 4771, 4785, 4774, 4778, 4783, 4781, 4777, 4537, 4769, 4768, 4542, 4775, 4779, 4782, 4780, 4772, 4784, 5095, 5434, 5472, 5620, 5622, 5608, 5616, 5621, 5623, 5617, 5633, 5634, 5626, 5624, 5630, 5631, 5628, 5636, 5643, 5602, 5645, 5647, 5642, 5576, 5650, 5607, 5618, 5612, 5613, 5669, 5651, 5614, 5672, 5673, 5713, 5635, 5637, 5706, 5640, 5644, 5675, 5714, 5615, 5619, 5625, 5627, 5629, 5632, 5638, 5639, 5641, 5646, 5648, 5649, 5652, 5670, 5710, 5712, 5763, 5789, 5791, 5814, 5829, 5853, 5860, 5861, 5862, 5863, 5891, 5917, 5938, 5941, 5942, 6094, 6126, 6227, 6243, 6286, 6287, 6288, 6289, 6290, 6291, 6292, 6293, 6294, 6295, 6300, 6301, 6344, 6367, 6365, 6366, 6370, 6364, 6368, 6371, 6369, 6376, 6375, 6373, 6374, 6460, 6372, 6467, 6459, 6409, 6410, 6473, 6463, 6472, 6474, 6481, 6407, 6462, 6466, 6475, 6461, 6468, 6477, 6482, 6483, 6490, 6491, 6479, 6526, 6476, 6537, 6408, 6527, 6478, 6550, 6534, 6533, 6565, 6492, 6529, 6494, 6551, 6528, 6570, 6569, 6573, 6568, 6577, 6538, 6530, 6578, 6580, 6668, 6721, 6572, 6673, 6575, 6571, 6574, 6576, 6579, 6680, 6582, 6732, 6907, 6884, 6883, 6917, 6953, 7634, 7632, 7580, 7636, 7635, 7633, 7856, 7976, 7927, 7924, 7925, 7926, 9060, 9061, 9039, 10021, 11025, 11040, 11010, 11034, 11511, 11539, 11527, 11037, 11545, 11546, 11049, 9057, 11540, 11535, 11543, 11031, 11043, 10039, 11512, 11046, 11542, 11599, 11510, 11028, 11055, 11052, 11544, 11541, 11588, 11017, 12282, 12284, 12357, 12421, 12441, 12448, 12447, 12439, 12283, 12452, 12464, 12449, 12450, 12458, 12462, 12459, 12467, 12471, 12443, 12451, 12420, 12469, 12547, 12558, 12454, 12559, 12611, 12630, 12560, 12444, 12455, 12463, 12445, 12465, 12466, 12553, 12556, 12562, 12627, 12446, 12599, 12457, 12468, 12417, 12557, 12555, 12453, 12502, 12470, 12440, 12460, 12590, 12472, 12461, 12438, 12628, 12442, 12629, 12626, 12456, 12554, 12631, 12634, 12635, 12666, 12632, 12747, 12669, 12748, 12750, 12668, 12824, 12774, 12753, 12682, 12836, 12789, 12840, 12749, 12752, 12844, 12837, 12751, 12667, 12823, 12838, 12788, 12839, 12820, 12863, 12841, 12843, 12842, 12821, 13087, 13055, 13054, 13053, 13082, 13056, 13435, 13428, 13433, 13436, 13426, 13427, 14425, 14610, 14672, 14673, 14724, 14723, 15060, 15050, 15057, 15035, 16022, 16008, 16244, 16414, 16230, 16231, 16415, 16416, 16417, 16418, 16419, 16420, 16421, 16422, 16423, 16427, 16428, 16429, 16430, 16461, 16462, 16542, 16550, 16551, 16554, 16557, 16558, 16559, 16560, 16561, 16563, 16564, 16566, 16567, 16568, 16570, 16582, 16607, 16608, 16615, 16616, 16631, 16633, 16652, 16654, 16659, 16664, 16673, 16675, 16676, 16693, 16696, 16698, 16701, 16706, 16709, 16691, 16687, 16714, 16704, 16713, 16712, 16426, 16565, 16694, 16695, 16703, 16700, 16720, 16721, 16431, 16722, 16575, 16697, 16665, 16707, 16424, 16710, 16708, 16425, 16717, 16718, 16705, 16699, 16716, 16719, 16692, 16715, 16702, 16600, 16711, 16723, 16725, 16688, 16728, 16729, 16732, 16730, 16724, 16727, 16726, 16731, 16738, 16733, 16735, 16826, 16769, 16739, 17001, 16775, 16734, 16991, 16996, 17003, 16736, 16768, 17002, 17000, 17012, 17020, 17025, 16737, 16990, 17007, 17019, 17030, 17016, 17028, 17050, 17052, 17009, 17051, 17083, 17077, 17053, 17021, 17029, 17080, 17082, 17107, 17018, 17011, 17114, 17115, 16997, 17063, 17110, 17116, 17117, 17120, 17017, 17109, 17062, 17113, 17121, 17134, 17139, 17078, 17147, 17005, 17006, 17138, 17108, 17142, 17183, 17119, 17156, 17157, 17158, 17244, 17276, 17004, 17248, 17146, 17140, 17285, 17143, 17286, 17245, 17205, 17161, 17287, 17152, 17284, 17036, 17313, 17333, 17008, 17141, 17334, 17468, 17296, 17288, 17213, 17469, 17394, 17549, 17550, 18512, 18535, 18554, 18548, 18562, 18552, 18578, 18547, 18568, 18582, 18584, 18592, 18628, 18623, 18583, 18614, 18649, 18615, 18651, 18546, 18640, 18598, 18690, 18712, 18685, 18706, 18711, 18710, 18621, 18625, 18627, 18622, 18658, 18717, 18604, 18722, 18879, 18721, 18618, 18851, 18624, 18655, 18617, 18709, 18822, 18869, 19044, 18718, 18784, 18715, 18783, 18594, 19043, 19142, 19377, 19052, 19379, 19392, 19383, 19386, 19399, 19387, 19617, 19619, 19388, 19622, 19620, 19380, 19398, 19385, 19390, 19741, 18654, 19382, 19763, 19400, 18672, 19779, 19916, 19949, 20019, 20051, 20085, 20114, 20124, 20143, 20084, 20160, 20123, 20178, 20125, 20161, 20158, 20186, 20141, 20199, 20187, 20189, 20252, 20201, 20207, 20245, 20208, 20345, 20330, 20229, 20447, 20274, 20329, 20303, 20391, 22570, 20392, 20304, 20500, 20253, 22777, 22817, 22820, 22610, 22855, 22756, 22674, 22672, 22816, 22859, 22627, 22857, 22675, 22852, 22671, 22843, 20254, 22626, 22850, 22657, 22764, 22856, 22853, 22734, 22623, 22851, 22821, 22981, 22818, 23298, 22884, 20323, 22673, 22676, 22736, 22858, 22887, 22854, 22883, 22885, 22860, 25140, 28704, 25141, 29145, 29147, 25139, 20669, 20675, 20671, 20677, 20910, 20912, 20900, 20674, 20913, 20667, 20673, 20901, 20899, 20678, 25138, 28333, 20666, 20668, 20676, 20672, 29146, 20670, 20905, 20911].includes(parseInt(itemid))) {
                        itemImage = (itemid <= 30000) ? `<img src='https://static.ragnaplace.com/bro/collection/${itemid}.png' alt='Item Image' style='width:24px; height:24px;'>` : '';
                    }

                    formattedData.push({
                        itemid: itemid,
                        item: `<a href='https://ratemyserver.net/item_db.php?item_id=${itemid}&small=1&back=1' target='_blank'>${itemImage} ${convertColors(itemName)}</a>`,
                        identifiedDescriptionName: convertColors(identifiedDescriptionName),
                        slotCount: slotCount,
                        Classe: convertColors(extractAdditionalInfo(identifiedDescriptionName, 'Classe')),
                        'Força de Ataque': convertColors(extractAdditionalInfo(identifiedDescriptionName, 'Força de Ataque')),
                        Peso: convertColors(extractAndFormatPeso(identifiedDescriptionName)),
                    });
                }

                return formattedData;
            }

            function extractAdditionalInfo(description, key) {
                var pattern = new RegExp(`${key}: (.*?)(?="|$)`, 'g');
                var match = pattern.exec(description);
                return match ? match[1].trim() : '';
            }

            function extractAndFormatPeso(description) {
                var pattern = /Peso: \^777777(\d+)/g;
                var match = pattern.exec(description);
                if (match) {
                    var pesoValue = match[1];
                    var pesoWithColor = `<span style="color: #FF0000;">${pesoValue}</span>`;
                    return pesoWithColor;
                }
                return '';
            }

            function createTable(data) {
                var dataTable = $('#itemTable').DataTable({
                    data: data,
                    columns: [
                        { data: 'itemid' },
                        { data: 'item' },
                        { data: 'identifiedDescriptionName' },
                        { data: 'slotCount' },
                        { data: 'Classe' },
                        { data: 'Força de Ataque' },
                        { data: 'Peso',}
                    ]
                });

                dataTable.on('draw', function () {
                    $('#itemTable td:nth-child(2)').css('text-align', 'left');
                });
            }

            fetchData().then(createTable).catch(function (error) {
            });
        });
